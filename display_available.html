<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registrar Monthly Rota</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f7f6;
            color: #333;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
        }

        h1 {
            color: #2c3e50;
        }

        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 25px;
        }

        .controls label {
            font-weight: bold;
        }

        .controls select {
            padding: 8px 12px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 16px;
        }

        .table-container {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background-color: #ffffff;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            padding: 15px;
        }

        .weekly-rota-table {
            width: 100%;
            border-collapse: collapse;
        }

        .weekly-rota-table th,
        .weekly-rota-table td {
            border: 1px solid #e0e0e0;
            padding: 12px;
            text-align: center;
        }

        .weekly-rota-table th {
            background-color: #f2f5f7;
            color: #555;
            font-weight: 600;
        }
        
        .registrar-name {
            background-color: #f8f9fa;
            font-weight: bold;
            text-align: left;
            width: 15%;
        }
        
        .available {
            background-color: #2ECC71; /* Green highlight for availability */
        }
    </style>
</head>
<body>

    <header>
        <h1>Registrar Standard Weekly Rota</h1>
        <p>Select a month to see the corresponding weekly schedule.</p>
    </header>

    <div class="controls">
        <label for="monthSelect">Month:</label>
        <select id="monthSelect"></select>
    </div>

    <div id="rota-container" class="table-container">
        <p>Loading registrar data...</p>
    </div>

    <script>
        // --- GLOBAL STATE ---
        let allRegistrars = [];
        const MONTH_NAMES = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            setupControls();
            fetchData();
        });

        function setupControls() {
            const monthSelect = document.getElementById('monthSelect');
            
            MONTH_NAMES.forEach((month, index) => {
                monthSelect.add(new Option(month, index));
            });
            
            // Set default to the current month
            monthSelect.value = new Date().getMonth();

            monthSelect.addEventListener('change', renderMonthlyRota);
        }

        async function fetchData() {
            try {
                const response = await fetch('registrars_data.json');
                if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                allRegistrars = await response.json();
                renderMonthlyRota();
            } catch (error) {
                document.getElementById('rota-container').innerHTML = `<p style="color: red; text-align: center;"><strong>Error:</strong> Could not load registrar data.</p>`;
                console.error("Fetch Error:", error);
            }
        }

        // --- RENDERING LOGIC ---
        function renderMonthlyRota() {
            const container = document.getElementById('rota-container');
            const selectedMonth = parseInt(document.getElementById('monthSelect').value);
            // The availability keys in the JSON are 1-12, so we add 1 to the month index (0-11)
            const monthKey = String(selectedMonth + 1);

            const SESSIONS = ["Mon AM", "Mon PM", "Tue AM", "Tue PM", "Wed AM", "Wed PM", "Thu AM", "Thu PM", "Fri AM", "Fri PM", "Weekends"];

            // --- Build Table Header ---
            let tableHTML = `<table class="weekly-rota-table"><thead><tr><th>Registrar</th>`;
            SESSIONS.forEach(session => {
                tableHTML += `<th>${session}</th>`;
            });
            tableHTML += `</tr></thead>`;

            // --- Build Table Body ---
            tableHTML += `<tbody>`;
            allRegistrars.forEach(reg => {
                tableHTML += `<tr><td class="registrar-name">${reg.name}</td>`;
                
                // Get the specific availability pattern for the selected month
                const monthPattern = reg.availability ? reg.availability[monthKey] : null;
                
                SESSIONS.forEach(session => {
                    const isAvailable = monthPattern && monthPattern[session];
                    tableHTML += `<td class="${isAvailable ? 'available' : ''}"></td>`;
                });
                
                tableHTML += `</tr>`;
            });
            tableHTML += `</tbody></table>`;
            
            container.innerHTML = tableHTML;
        }
    </script>
</body>
</html>
